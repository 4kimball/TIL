# IP 주소를 찾았다면 HTTP 메시지를 서버에 어떻게 보낼까?

> DNS 서버에서 IP 주소를 조회했다. 이제는 IP 주소를 **프로토콜 스택**에 의뢰하여 HTTP 메시지를 서버에 보내고자한다. 



### :one: 브라우저는 OS의 프로토콜 스택에 송신을 의뢰한다.

- 브라우저는 데이터를 송신하는 기능이 없다. 따라서 OS 내부의 프로토콜 스택에 데이터 송신을 의뢰한다.
- 브라우저뿐만 아니라 모든 네트워크 애플리케이션은 프로토콜 스택에 의뢰하여 데이터를 송수신하게된다.
- DNS 서버에 IP 주소를 조회할 때처럼 Socket 라이브러리에 있는 부품을 사용한다.
- 서버와 클라이언트는 파이프와 같은 개념으로 연결되어 데이터를 양방향으로 송수신하고 이때 양측에서 **데이터의 출입구**를 **소켓**이라고 한다. 
- 서버 측에서 소켓을 생성하고 클라이언트가 서버 측의 소켓에 연결을 한다.
- 송수신이 완료되었을 때는 서버나 클라이언트 아무 곳에서 연결을 끊어도된다.



### :two: 소켓을 생성해보자.

- 소켓을 생성하여 데이터를 송신할 때는 일련의 과정대로 진행된다.
  - 준비 -> connect -> write -> read -> close

`socket 호출`

- 소켓을 생성하기 위해서는 Socket 라이브러리에서 socket이라는 프로그램 부품을 호출하기만 하면된다.
- 호출을 한다면 **디스크립터**를 넘겨받게 되는데, 디스크립터는 소켓을 식별하기위한 번호라고 생각하면된다. 컴퓨터 내부에서 socket을 통한 데이터 송수신이 동시에 발생할 수 있기 때문에 디스크립터로 구분하는 것이다.

`connect`

- 소켓을 생성했다면 서버측에 연결을 해야한다. 이때 connect이라는 프로그램을 사용한다.
- connect를 사용할 때는 디스크립터, 서버의 IP주소, 포트번호가 필요하다.
- 여기서 포트번호는 어떤 소켓에 접속할지 알려주는 것이다. IP 주소로 서버 컴퓨터까지 도달하기는 했지만 어떤 소켓에 연결을 해야할지 모르기때문에 포트번호를 통해 원하는 소켓과 연결을 하게된다.
  - 웹은 80번, 메일은 25번
  - 포트번호는 접속하는 상대의 소켓을 식별하기 위해 사용된다.
  - 클라이언트측의 포트번호는 socet을 생성할 때 프로토콜 스택이 어떠한 값을 골라 할당하게된다.

`write`

- 데이터를 송신할 때는 write라는 프로그램을 사용한다.
- write를 사용할 때 디스크립터, 송신 데이터, 송신 데이터길이가 필요하다.
- 메모리에 송신데이터를 준비하면 프로토콜 스택이 송신 데이터를 서버에 전송한다.

`read`

- 데이터를 수신할 때는 read를 사용하며 수신 데이터 길이를 전달받는다.
- 수신한 응답 메시지는 **수신 버퍼**라는 메모리영역에 저장되어 있다.
- 이전에 LAN을 통해 카메라의 데이터를 실시간으로 받아올 때 Socket 라이브러리를 사용하였다. 카메라의 데이터를 받아온 것을 전처리하는 과정이 있었는데 전달받은 수신 데이터 길이를 활용했던 기억이 있다.

`close`

- 데이터의 송수신이 완료된다면 close라는 프로그램을 통해 연결을 끊는다.
- 웹 서버에서 먼저 close를 호출하여 연결을 끊게되고 이것이 클라이언트에 전달되어 끊기 단계에 들어간다.

