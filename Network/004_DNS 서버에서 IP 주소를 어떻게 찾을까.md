# DNS 서버에서 IP 주소를 어떻게 찾을까

> DNS 서버는 클라이언트에서 요청받은 메시지를 받고 메시지에 있는 내용을 찾아 응답한다. 그렇다면 DNS 서버에서 어떻게 IP 주소를 찾는걸까?



### :one: 메시지의 구성

- DNS 서버는 클라이언트에서 받은 메시지를 바탕으로 조회를 하며 메시지에는 3가지 정보가 포함되어 있다.
- `이름` : 서버나 메일 목적지와 같은 이름이다. 흔히 www.naver.com을 나타낸다.
- `클래스` : DNS의 구조를 잡을 때 인터넷 이외의 네트워크에서 사용할 것까지 생각했지만 지금은 인터넷에서만 사용되며 IN이라는 값을 사용한다.
- `타입` : 이름에 어떤 타입의 정보가 지원되는지 나타내며 A이면 IP 주소가 지원되고 MX이면 메일 배송 목적지가 지원된다. 이 타입에 따라 클라이언트에 회답하는 정보의 내용이 달라진다.



### :two: 모든 DNS 서버에 모든 주소들이 담겨있는 걸까?

- 인터넷에는 많은 주소들이 있고 이를 하나의 DNS 서버에 등록하는 것은 불가능하다. 그래서 조회 메시지를 받은 DNS 서버에 정보가 등록되어 있지 않을 수 있다.
- **따라서 정보를 분산시켜 다수의 DNS 서버에 등록하고, 이 DNS 서버들이 연대하여 정보를 찾아낸다**
- DNS 서버에 등록할 때는 도메인명에서 점으로 구분된 도메인을 계층적으로 저장한다. 예를 들어 `www.naver.com` 은 `com`과 `naver`각 각각 다른 DNS 서버에 저장되고 이 두 개의 도메인은 계층적인 관계를 갖는다. com -> naver -> www
- `www.example.co.kr`을 예로 들면, `kr`은 대한민국에 할당된 도메인, `co`는 국내의 도메인을 분류하고 `example`이 특정 회사나 기관을 나타낸다.



### :three: 그렇다면 분산된 DNS 서버에서 어떻게 IP 주소를 찾을까?

- 메시지를 조회하기 위해 수만 대의 DNS 서버를 탐색할 수 없기 때문에 **상하관계**로 DNS 서버를 연결한다.
- 하위의 도메인을 담당하는 DNS서버 -> 상위의 도메인을 담당하는 DNS 서버
- 즉 `example`을 담당하는 DNS 서버 -> `co`를 담당하는 DNS 서버 -> `kr`을 담당하는 DNS 서버처럼 연결이 된다.
- 또한 인터넷의 도메인은 최상위 도메인인 `kr`이나 `com`위에 `.`으로 루트 도메인이 있다. 메시지를 조회할 때 루트 도메인에서부터 아래로 내려오면서 찾게된다.
- 클라이언트에서 DNS 서버에 접근하면 루트 도메인을 경유하여 도메인의 계층 아래로 찾아가서 원하는 DNS 서버에 도착하게된다.
- **정리**
  - 가장 가까운 DNS 서버에 접근하여 원하는 정보를 찾지 못한다면 루트 도메인으로 간다.
  - 루트 도메인에서 하위 도메인으로 내려오면서 원하는 정보를 탐색한다.



### :four: IP주소를 찾을 때마다 이러한 과정을 반복?

- DNS 서버는 한 번 조회한 이름을 캐시에 기록할 수 있다.
- 어떠한 이름에 해당하는 정보가 캐시에 저장되어 있으면 바로 응답을 할 수 있다.
- 존재하지 않는 정보를 탐색하여 받은 응답도 캐시에 저장된다.
- 하지만 캐시에 저장된 정보가 정확하지 않을 수 있다. DNS 서버에 등록된 정보가 변경 되거나 삭제될 수도 있기 때문이다. 