# 프로토콜 스택에 대해서

> 실제로 데이터를 송수신하는 프로토콜 스택의 내부 구조와 동작을 알아본다.



### :one: 프로토콜 스택의 내부 구성

- TCP/IP 계층 구조로 되어 있으며 맨 위에있는 애플리케이션 층에서부터 시작된다.
- 애플리케이션 층에서는 웹 브라우저, 메일과 같은 네트워크 애플리케이션이 존재하며 Socket 라이브러리가 포함되어 있다. 
- 애플리케이션 층에서 OS에 있는 **프로토콜 스택**으로 데이터 송신을 의뢰하며, 프로토콜 스택에는 TCP, UDP, IP가 존재한다. 
  - TCP의 경우 웹 브라우저나 메일 등 일반적인 애플리케이션이 데이터를 송수신할 때 사용되며 UDP는 DNS 서버에 대한 조회 등 짧은 제어용 데이터를 송수신할 때 사용한다.
  - IP는 목적지까지 데이터를 송수신하는 역할을 하며 패킷단위로 분할하여 데이터를 송수신한다.
  - IP 안에는 ICMP, ARP가 존재하는데 ICMP는 패킷을 전송할 때 발생하는 오류를 통지하거나 제어용 메시지를 통지할 때 사용되고 ARP는 MAC 주소를 조사할 때 사용된다.
- 이후 LAN 드라이버가 LAN 어댑터를 제어하여 LAN 어댑터에서 실제로 데이터 송수신이 이루어지게 된다.



### :two: 소켓은 제어용 정보를 담은 메모리

- 프로토콜 스택은 메모리 영역에 제어 정보를 기록하여 통신 동작을 제어한다. 소켓은 개념적인 것이며 제어정보가 기록된 메모리 영역이 소켓의 실체라고 생각할 수 있다.
- 프로토콜 스택은 제어정보를 참조하면서 동작한다.
- windows에서 netstat라는 명령을 통해 추상적이었던 소켓의 내용을 확인할 수 있다.
- netstat라는 명령을 실행하면
  - 프로토콜의 종류, 로컬환경의 IP주소와 포트번호, 통신 상대의 IP주소와 포트번호, 통신상태, PID 등이 ㅍ함되어 있다.



### :three: Socket을 호출했을 때

- 네트워크 애플리케이션이 socket이나 connect라는 Socket 라이브러리의 프로그램 부품을 호출하여 데이터 송수신을 의뢰한다.
- 네트워크 애플리케이션이 의뢰를 하면서 하나의 소켓이 생성되는데 프로토콜 스택은 소켓 한 개 분량의 메모리 영역을 확보하게 된다.
- 통신을 위한 제어용 정보를 확보한 메모리 영역에 기록한다.
- 소켓이 생성된다면 소켓을 나타내는 디스크립터를 네트워크 애플리케이션에 알려준다.